<!DOCTYPE html>
<html>
<title>HarriI</title>

<head>
</head>
<style>
    #video {
        border: 1px solid #999;
        width: 98%;
        max-width: 860px;
    }

    #box-button {
        display: flex;
    }

    #box-button>*:not(:last-child) {
        margin-right: 16px;
    }
</style>

<body>
    <div id="box-button">
        <button id="start">Start Capture</button>
        <button id="stop" style="display:none;">Stop Capture</button>
        <button id="pause" style="display:none;">Pause Capture</button>
        <button id="resume" style="display:none;">Resume Capture</button>
    </div>
    <video id="video" autoplay></video>
    <p id="description"></p>
    <br />
</body>
<script>
    let start = document.getElementById('start'),
        stop = document.getElementById('stop'),
        description = document.getElementById('description'),
        pause = document.getElementById('pause'),
        resume = document.getElementById('resume'),
        mediaRecorder;

    const videoElem = document.getElementById("video");

    const recordScreen = async () => {
        return await navigator.mediaDevices.getDisplayMedia({
            audio: true,
            video: { mediaSource: "screen" }
        });
    }

    const saveFile = (recordedChunks) => {
        const blob = new Blob(recordedChunks, {
            type: 'video/webm'
        });
        let filename = window.prompt('Enter file name'),
            downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = `${filename || 'HarriI'}.webm`;

        document.body.appendChild(downloadLink);
        downloadLink.click();
        URL.revokeObjectURL(blob); // clear from memory
        document.body.removeChild(downloadLink);
    }

    const createRecorder = (stream, mimeType) => {
        // the stream data is stored in this array
        let recordedChunks = [];
        const mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = function (e) {
            if (e.data.size > 0) {
                recordedChunks.push(e.data);
            }
        };
        mediaRecorder.onstop = function () {
            saveFile(recordedChunks);
            recordedChunks = [];
        };
        mediaRecorder.start(200); // For every 200ms the stream data will be stored in a separate chunk.
        return mediaRecorder;
    }

    const startRecord = async () => {
        let stream = await recordScreen();
        videoElem.srcObject = stream
        const videoTrack = videoElem.srcObject.getVideoTracks()[0];
        let mimeType = 'video/webm';
        mediaRecorder = createRecorder(stream, mimeType);
        description.innerHTML = "Started recording";
        start.style.display = "none";
        stop.style.display = "block";
        pause.style.display = "block";
        resume.style.display = "block";
    }

    const stopRecord = () => {
        mediaRecorder.stop();
        let tracks = videoElem.srcObject.getTracks();

        tracks.forEach((track) => track.stop());
        description.innerHTML = "Stopped recording";
        start.style.display = "block";
        stop.style.display = "none";
        pause.style.display = "none";
        resume.style.display = "none";
    }

    const pauseRecord = () => {
        mediaRecorder.pause();
        description.innerHTML = "Pause";
    }

    const resumeRecord = () => {
        mediaRecorder.resume();
        description.innerHTML = "Resume";
    }

    start.addEventListener('click', startRecord)

    stop.addEventListener('click', stopRecord)

    pause.addEventListener('click', pauseRecord)

    resume.addEventListener('click', resumeRecord)

</script>

</html>
